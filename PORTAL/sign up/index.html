<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal - Sign Up</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="../notifications.css">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <div class="form-box">
      <h2>SIGN UP</h2>
      <form id="signupForm">
        <!-- Name -->
        <div class="input-box">
          <input type="text" id="name" placeholder="Name" required>
        </div>

        <!-- Email -->
        <div class="input-box">
          <input type="email" id="email" placeholder="Email Id" required>
        </div>

        <!-- Password -->
        <div class="input-box password-box">
          <input type="password" id="password" placeholder="Password (min 8 characters)" required minlength="8">
          <span class="toggle-password" onclick="togglePassword('password')">
            <i class="fa fa-eye" id="password-eye"></i>
          </span>
        </div>
        <small class="password-hint">Password must be at least 8 characters long</small>

        <!-- Role selection -->
        <div class="input-box">
          <select id="role" required>
            <option value="">Select Role</option>
            <option value="student">Student</option>
            <option value="parent">Parent</option>
            <option value="teacher">Teacher</option>
            <option value="admin">Admin</option>
          </select>
        </div>

        <p class="forgot"><a href="#">Lost password? Click Here!</a></p>

        <div class="button-group">
          <button type="submit" class="btn primary">Sign Up</button>
          <!-- Use anchor for Sign In navigation -->
          <a href="../index.html" class="btn secondary">Sign In</a>
        </div>
      </form>
    </div>
  </div>
  <script>
    // Inline Authentication System (No external dependencies)
    class SimpleAuth {
      constructor() {
        this.users = JSON.parse(localStorage.getItem('heavenly_users') || '[]');
      }
      
      hashPassword(password) {
        let hash = 0;
        for (let i = 0; i < password.length; i++) {
          const char = password.charCodeAt(i);
          hash = ((hash << 5) - hash) + char;
          hash = hash & hash;
        }
        return Math.abs(hash).toString(16);
      }
      
      signup(name, email, password, role) {
        try {
          if (!name || !email || !password || !role) {
            return { success: false, message: 'All fields are required' };
          }

          // Check if user exists
          const exists = this.users.find(u => u.email === email);
          if (exists) {
            return { success: false, message: 'Email already registered' };
          }

          // Create user
          const user = {
            id: Date.now().toString(),
            name,
            email,
            passwordHash: this.hashPassword(password),
            role,
            createdAt: new Date().toISOString()
          };
          
          this.users.push(user);
          localStorage.setItem('heavenly_users', JSON.stringify(this.users));

          return { 
            success: true,
            message: 'Account created successfully!',
            user: { 
              id: user.id, 
              name: user.name, 
              fullName: user.name, 
              email: user.email, 
              role: user.role 
            }
          };
        } catch (error) {
          return { success: false, message: error.message };
        }
      }
    }

    // Create global auth instance
    window.localAuth = new SimpleAuth();

    // Toggle password visibility
    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      const eye = document.getElementById(inputId + '-eye');
      
      if (input.type === 'password') {
        input.type = 'text';
        eye.classList.remove('fa-eye');
        eye.classList.add('fa-eye-slash');
      } else {
        input.type = 'password';
        eye.classList.remove('fa-eye-slash');
        eye.classList.add('fa-eye');
      }
    }

    // Validate password strength
    function validatePassword(password) {
      if (password.length < 6) {
        return "Password must be at least 6 characters long";
      }
      return null; // Valid password
    }

    // Simple notification functions
    function showSuccess(message) {
      alert('âœ… ' + message);
    }

    function showError(message) {
      alert('âŒ ' + message);
    }

    function showLoading(message) {
      console.log('Loading:', message);
    }

    function hideLoading() {
      console.log('Loading complete');
    }

    function setButtonLoading(button, loading) {
      if (loading) {
        button.disabled = true;
        button.textContent = 'Creating Account...';
      } else {
        button.disabled = false;
        button.textContent = 'Sign Up';
      }
    }

    // Handle signup form
    document.addEventListener("DOMContentLoaded", () => {
      const signupForm = document.getElementById("signupForm");

      if (signupForm) {
        signupForm.addEventListener("submit", async (e) => {
          e.preventDefault();

          const name = document.getElementById("name").value.trim();
          const email = document.getElementById("email").value.trim();
          const password = document.getElementById("password").value.trim();
          const role = document.getElementById("role").value;

          if (!name || !email || !password || !role) {
            showError("Please fill in all fields.");
            return;
          }

          // Validate password
          const passwordError = validatePassword(password);
          if (passwordError) {
            showError(passwordError);
            return;
          }

          try {
            const submitBtn = document.querySelector('button[type="submit"]');
            setButtonLoading(submitBtn, true);
            showLoading('Creating your account...');

            const result = window.localAuth.signup(name, email, password, role);
            
            if (result.success) {
              showSuccess('Welcome, ' + result.user.fullName + '! You can now sign in.');
              
              // Redirect to signin page
              setTimeout(() => {
                window.location.href = '../index.html';
              }, 2000);
            } else {
              showError(result.message);
              setButtonLoading(submitBtn, false);
            }

          } catch (error) {
            console.error('Signup error:', error);
            showError('Signup failed: ' + error.message);
            setButtonLoading(submitBtn, false);
          } finally {
            hideLoading();
          }
        });
      }
    });

    console.log('âœ… Signup system loaded successfully');
  </script>
</body>
</html>
  <script>
    // Redirect to new access request system
    document.addEventListener('DOMContentLoaded', function() {
      const notice = document.createElement('div');
      notice.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        z-index: 10000;
        text-align: center;
        max-width: 90%;
      `;
      notice.innerHTML = `
        <strong>ðŸ”„ Portal System Updated!</strong><br>
        <small>We now use access codes for better reliability</small><br>
        <button onclick="window.location.href='../request-access.html'" style="background: white; color: #007bff; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; cursor: pointer; font-weight: bold;">Request Access Code</button>
        <button onclick="this.parentElement.remove()" style="background: transparent; color: white; border: 1px solid white; padding: 8px 15px; border-radius: 5px; margin: 10px 0 0 10px; cursor: pointer;">Close</button>
      `;
      document.body.appendChild(notice);
    });
  </script>